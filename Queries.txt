
1.Which products have generated the highest revenue (Top 10)?
Purpose: To understand the top-performing products based on revenue, which can guide inventory decisions and marketing strategies.

SELECT
	p.ProductName,
	SUM(o.UnitPrice*o.Quantity) AS TotalRevenue
FROM product p
Join orderitem o
ON p.Id = o.ProductId
GROUP BY p.ProductName
ORDER BY TotalRevenue Desc
LIMIT 10;

2. Which customers have placed the most orders, and what is their total spending?
Purpose: To find the top customers who generate the most revenue.
Analysis: Useful for customer segmentation and loyalty programs.

SELECT
	c.FirstName,
	c.LastName,
	Count(*) AS NoOfOrders,
	SUM(o.TotalAmount) AS TotalAmountSpent
FROM customer c
JOIN orders o
ON c.Id = o.CustomerId
GROUP BY 
	c.FirstName,
	c.LastName
ORDER BY NoOfOrders Desc,
	TotalAmountSpent Desc;

3. What is the average order value for customers by region (City/Country)?
Purpose: To analyze customer purchasing behavior based on location.
Analysis: Helps in targeting specific regions for promotional efforts or inventory planning.

SELECT
	c.City,
	c.Country,
	Avg(o.TotalAmount) AS AverageOrderValue
FROM customer c
JOIN orders o
ON c.Id = o.CustomerId
GROUP BY 
	c.City,
	c.Country
ORDER BY AverageOrderValue Desc;

4. Which products have had the highest sales and based on these sales, may be running low on stock?
Purpose: To identify products that have experienced high demand and may require restocking soon.
Analysis: Helps in inventory management by highlighting products that sold well historically, which may still need to be replenished based on past sales volumes. This can assist in avoiding stockouts for high-demand products.

SELECT
	ProductName,
	SUM(o.Quantity) AS TotalSales
FROM product p
JOIN orderitem o
ON p.Id = o.ProductId
GROUP BY ProductName
ORDER BY TotalSales Desc;

5. How much revenue did each supplier generate from their products?
Purpose: To measure the performance of suppliers based on the revenue generated by their products.
Analysis: Useful for evaluating supplier effectiveness and deciding where to focus procurement efforts.

SELECT
	s.CompanyName,
	p.ProductName,
	SUM(o.UnitPrice*o.Quantity) AS Revenue
FROM supplier s
JOIN product p
ON s.Id = p.SupplierId
JOIN orderitem o
ON p.Id = o.OrderId
GROUP BY 
	s.CompanyName,
	p.ProductName
ORDER BY Revenue Desc;

6. Which discontinued products have still been sold and what is the total revenue they generated during this period?
Purpose: To understand the residual sales of discontinued products and make informed decisions about inventory clearance or special offers.

SELECT
	p.ProductName,
	SUM(o.UnitPrice*o.Quantity) AS Revenue
FROM product p
Join orderitem o
ON p.Id = o.ProductId
WHERE p.IsDiscontinued = b'1'
GROUP BY p.ProductName
ORDER BY Revenue Desc;

7. Product Bundling and Cross-Selling Opportunities
Which products are most frequently purchased together (bundled) in the same order, and what is the total revenue generated from these bundles?
Purpose: To identify cross-selling opportunities, helping to design product bundles or upsell strategies.

WITH productbundles AS(
	SELECT
		p1.ProductName AS Product1,
		p2.ProductName AS Product2,
		SUM(o1.UnitPrice*o1.Quantity + o2.UnitPrice*o2.Quantity) AS TotalRevenue,
		Count(*) AS Frequency
	FROM orderitem o1
	JOIN orderitem o2
		ON o1.OrderId = o2.OrderId
		AND o1.ProductId < o2.ProductId
	JOIN product p1
		ON o1.ProductId = p1.Id
	JOIN product p2
		ON o2.ProductId = p2.Id
	GROUP BY 
		p1.ProductName, p2.ProductName
)
SELECT
	Product1,
	Product2,
	TotalRevenue,
	Frequency
FROM productbundles
WHERE Frequency = (SELECT MAX(Frequency) FROM productbundles)
;

8. Exit
